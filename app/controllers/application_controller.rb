# Filters added to this controller apply to all controllers in the application.
# Likewise, all the methods added will be available for all controllers.

class ApplicationController < ActionController::Base
  helper :all # include all helpers, all the time
  protect_from_forgery # See ActionController::RequestForgeryProtection for details

  # Scrub sensitive parameters from your log
  # filter_parameter_logging :password

  before_filter :ensure_domain
  before_filter :load_cloud_tag

  private

  def ensure_domain
    if ENV["DOMAIN_TO_REDIRECT_TO"] && request.env['HTTP_HOST'] != ENV["DOMAIN_TO_REDIRECT_TO"]
      redirect_to request.url.sub(request.env['HTTP_HOST'], ENV["DOMAIN_TO_REDIRECT_TO"])
    end
  end

  def render_404
    respond_to do |type|
      type.html { render :file => "#{RAILS_ROOT}/public/404.html",  :status => 404 }
      type.all { render :nothing => true, :status => 404 }
    end
    true # so we can do "render_404 and return"
  end

  def load_cloud_tag
    @show_tag_cloud = true
    @term_tags_for_cloud = JSON.parse(@@term_tag_count_json)
  end

  @@term_tag_count_json = "[[\"RPT\",42630,\"rpt\"],[\"TF\",34888,\"tf\"],[\"ISAF\",26376,\"isaf\"],[\"IED\",21631,\"ied\"],[\"FF\",18913,\"ff\"],[\"FOB\",17092,\"fob\"],[\"IVO\",16884,\"ivo\"],[\"BDA\",15521,\"bda\"],[\"NFTR\",13315,\"nftr\"],[\"ANP\",12712,\"anp\"],[\"EOD\",12428,\"eod\"],[\"ATT\",11706,\"att\"],[\"TIC\",11380,\"tic\"],[\"ANA\",11163,\"ana\"],[\"WIA\",10263,\"wia\"],[\"INS\",10174,\"ins\"],[\"RPG\",8972,\"rpg\"],[\"UNK\",8365,\"unk\"],[\"IDF\",8064,\"idf\"],[\"medevac\",7651,\"medevac\"],[\"CF\",7498,\"cf\"],[\"KIA\",7152,\"kia\"],[\"NFI\",6780,\"nfi\"],[\"LN\",6398,\"ln\"],[\"Coy\",6373,\"coy\"],[\"MM\",5504,\"mm\"],[\"CAS\",5237,\"cas\"],[\"CoP\",5152,\"cop\"],[\"Op\",5122,\"op\"],[\"QRF\",5071,\"qrf\"],[\"POO\",4837,\"poo\"],[\"Element\",4689,\"element\"],[\"AAF\",4401,\"aaf\"],[\"PAX\",4116,\"pax\"],[\"PID\",4093,\"pid\"],[\"vic\",3832,\"vic\"],[\"DC\",3677,\"dc\"],[\"ANSF\",3598,\"ansf\"],[\"BAF\",3460,\"baf\"],[\"CIV\",3451,\"civ\"],[\"UXO\",3394,\"uxo\"],[\"FP\",3327,\"fp\"],[\"ISO\",3222,\"iso\"],[\"w/u\",3169,\"wu\"],[\"CJSOTF\",3149,\"cjsotf\"],[\"MOD\",3125,\"mod\"],[\"w/d\",3023,\"wd\"],[\"FB\",2961,\"fb\"],[\"RTB\",2817,\"rtb\"],[\"ACM\",2690,\"acm\"],[\"RTE\",2382,\"rte\"],[\"BG\",2364,\"bg\"],[\"DBC\",2351,\"dbc\"],[\"IOT\",2293,\"iot\"],[\"S//REL\",2276,\"srel\"],[\"Line 4\",2238,\"line-4\"],[\"DF\",2234,\"df\"],[\"Line 3\",2234,\"line-3\"],[\"Line 2\",2225,\"line-2\"],[\"Line 1\",2220,\"line-1\"],[\"RCP\",2195,\"rcp\"],[\"PT\",2182,\"pt\"],[\"NSTR\",2057,\"nstr\"],[\"KAF\",2037,\"kaf\"],[\"NDS\",2018,\"nds\"],[\"CWIED\",1998,\"cwied\"],[\"C/S\",1981,\"cs\"],[\"POI\",1921,\"poi\"],[\"TB\",1739,\"tb\"],[\"GCTF\",1671,\"gctf\"],[\"PKM\",1564,\"pkm\"],[\"JAF\",1555,\"jaf\"],[\"HLZ\",1510,\"hlz\"],[\"Shura\",1475,\"shura\"],[\"rds/RDS\",1454,\"rdsrds\"],[\"ETT\",1365,\"ett\"],[\"AO\",1329,\"ao\"],[\"CCA\",1289,\"cca\"],[\"ICOM\",1244,\"icom\"],[\"ABP\",1233,\"abp\"],[\"Illum\",1224,\"illum\"],[\"MTF\",1223,\"mtf\"],[\"A/C\",1221,\"ac\"],[\"EKIA\",1195,\"ekia\"],[\"GSW\",1159,\"gsw\"],[\"Toc\",1149,\"toc\"],[\"RC E\",1086,\"rc-e\"],[\"GBU\",1083,\"gbu\"],[\"LZ\",1061,\"lz\"],[\"SAW\",1048,\"saw\"],[\"FFIR\",1047,\"ffir\"],[\"HMG\",1026,\"hmg\"],[\"BTIF\",1023,\"btif\"],[\"AK-47\",1015,\"ak-47\"],[\"CDR\",955,\"cdr\"],[\"CJTF\",945,\"cjtf\"],[\"HWY\",866,\"hwy\"],[\"cpt\",861,\"cpt\"],[\"White Eagle\",845,\"white-eagle\"],[\"MAR\",819,\"mar\"],[\"BN\",808,\"bn\"],[\"IO\",803,\"io\"],[\"PMT\",789,\"pmt\"],[\"ODA\",759,\"oda\"],[\"Msr\",734,\"msr\"],[\"IRoA\",726,\"iroa\"],[\"TERP\",725,\"terp\"],[\"BSN\",710,\"bsn\"],[\"IAW\",686,\"iaw\"],[\"usfor-a\",681,\"usfor-a\"],[\"CJTF-82\",677,\"cjtf-82\"],[\"ECP\",676,\"ecp\"],[\"AFG\",666,\"afg\"],[\"JTAC\",659,\"jtac\"],[\"JBAD\",647,\"jbad\"],[\"MP\",641,\"mp\"],[\"MG\",637,\"mg\"],[\"ISR\",633,\"isr\"],[\"SIGACT\",615,\"sigact\"],[\"UAV\",597,\"uav\"],[\"vitals\",591,\"vitals\"],[\"TFK\",580,\"tfk\"],[\"VBIED\",571,\"vbied\"],[\"ROE\",569,\"roe\"],[\"Litter\",559,\"litter\"],[\"CAT C\",507,\"cat-c\"],[\"LNO\",497,\"lno\"],[\"fps\",484,\"fps\"],[\"sqn\",479,\"sqn\"],[\"MSN\",457,\"msn\"],[\"MAJ\",443,\"maj\"],[\"GBU-38\",441,\"gbu-38\"],[\"MOI\",435,\"moi\"],[\"SVBIED\",422,\"svbied\"],[\"UNAMA\",410,\"unama\"],[\"OBJ\",407,\"obj\"],[\"SIR\",406,\"sir\"],[\"eof\",400,\"eof\"],[\"SSE\",397,\"sse\"],[\"KDZ\",396,\"kdz\"],[\"PAKMIL\",392,\"pakmil\"],[\"SWT\",386,\"swt\"],[\"CLP\",383,\"clp\"],[\"Jingle trucks\",381,\"jingle-trucks\"],[\"LTC\",379,\"ltc\"],[\"DoS\",379,\"dos\"],[\"RGR\",376,\"rgr\"],[\"AUP\",372,\"aup\"],[\"UAH\",372,\"uah\"],[\"PTS\",367,\"pts\"],[\"GEN\",365,\"gen\"],[\"CJ3\",363,\"cj3\"],[\"GHZ\",350,\"ghz\"],[\"ANAP\",347,\"anap\"],[\"PRT CDR\",340,\"prt-cdr\"],[\"RG\",333,\"rg\"],[\"evac\",329,\"evac\"],[\"sof\",328,\"sof\"],[\"BDE\",327,\"bde\"],[\"VCP\",324,\"vcp\"],[\"ISN\",320,\"isn\"],[\"PBG\",318,\"pbg\"],[\"ARSIC\",315,\"arsic\"],[\"PAK\",293,\"pak\"],[\"81\",281,\"81\"],[\"HHB\",281,\"hhb\"],[\"F-15\",277,\"f-15\"],[\"UH-60\",277,\"uh-60\"],[\"GBU-12\",262,\"gbu-12\"],[\"JDOC\",259,\"jdoc\"],[\"BTL\",255,\"btl\"],[\"KPRT\",250,\"kprt\"],[\"DSHKA\",244,\"dshka\"],[\"OMF\",230,\"omf\"],[\"MS\",230,\"ms\"],[\"PL\",227,\"pl\"],[\"VPB\",226,\"vpb\"],[\"RPK\",224,\"rpk\"],[\"GBU-31\",215,\"gbu-31\"],[\"TTPs\",213,\"ttps\"],[\"SQD\",203,\"sqd\"],[\"PA\",200,\"pa\"],[\"OGA\",199,\"oga\"],[\"NMC\",196,\"nmc\"],[\"ATTK\",189,\"attk\"],[\"LKG\",178,\"lkg\"],[\"TCP\",172,\"tcp\"],[\"JOC\",171,\"joc\"],[\"CHOPS\",168,\"chops\"],[\"CDN\",165,\"cdn\"],[\"IRT\",164,\"irt\"],[\"PHQ\",163,\"phq\"],[\"FRA BG\",159,\"fra-bg\"],[\"SOTF\",159,\"sotf\"],[\"S-2\",156,\"s-2\"],[\"INFIL\",156,\"infil\"],[\"NCO\",154,\"nco\"],[\"MHL\",152,\"mhl\"],[\"GMLRS\",150,\"gmlrs\"],[\"MED OPS\",149,\"med-ops\"],[\"KAIA\",144,\"kaia\"],[\"IR STROBE\",141,\"ir-strobe\"],[\"TERPS\",138,\"terps\"],[\"GIRoA\",133,\"giroa\"],[\"STB\",130,\"stb\"],[\"OIC\",130,\"oic\"],[\"BFT\",129,\"bft\"],[\"PEN\",124,\"pen\"],[\"Csh\",124,\"csh\"],[\"m240b\",122,\"m240b\"],[\"CDO RM\",120,\"cdo-rm\"],[\"FSB\",114,\"fsb\"],[\"NAI\",112,\"nai\"],[\"poc\",108,\"poc\"],[\"CIVCAS\",108,\"civcas\"],[\"AC-130\",107,\"ac-130\"],[\"Role 3\",107,\"role-3\"],[\"HRT\",106,\"hrt\"],[\"RCAG\",105,\"rcag\"],[\"TBD\",96,\"tbd\"],[\"SPC\",95,\"spc\"],[\"ASV\",91,\"asv\"],[\"BRF\",89,\"brf\"],[\"RC CENTRAL\",85,\"rc-central\"],[\"FO\",82,\"fo\"],[\"JDAM\",81,\"jdam\"],[\"SIED\",79,\"sied\"],[\"FIR\",78,\"fir\"],[\"rfs\",76,\"rfs\"],[\"CCIR\",68,\"ccir\"],[\"VSA\",67,\"vsa\"],[\"SOP\",67,\"sop\"],[\"J COY 42 CDO\",64,\"j-coy-42-cdo\"],[\"LEP\",64,\"lep\"],[\"INTSUM\",63,\"intsum\"],[\"AQ\",62,\"aq\"],[\"Solatia\",62,\"solatia\"],[\"RC N\",62,\"rc-n\"],[\"PAO\",62,\"pao\"],[\"Green on green\",60,\"green-on-green\"],[\"RCC\",59,\"rcc\"],[\"SOG\",58,\"sog\"],[\"Luna\",54,\"luna\"],[\"PEF\",54,\"pef\"],[\"VP\",53,\"vp\"],[\"helos\",53,\"helos\"],[\"KJI\",52,\"kji\"],[\"EVACD\",51,\"evacd\"],[\"NC\",46,\"nc\"],[\"CJ2\",46,\"cj2\"],[\"JPEL\",44,\"jpel\"],[\"TG\",43,\"tg\"],[\"PRED\",43,\"pred\"],[\"CD\",39,\"cd\"],[\"RC S\",38,\"rc-s\"],[\"KMTC\",37,\"kmtc\"],[\"DOI\",37,\"doi\"],[\"TBC\",36,\"tbc\"],[\"NOFORN\",36,\"noforn\"],[\"CG\",34,\"cg\"],[\"AH-1W\",34,\"ah-1w\"],[\"BCT\",34,\"bct\"],[\"ACK\",34,\"ack\"],[\"S-5\",33,\"s-5\"],[\"M249\",33,\"m249\"],[\"9-liner\",33,\"9-liner\"],[\"ANBP\",33,\"anbp\"],[\"OC\",32,\"oc\"],[\"RC W\",30,\"rc-w\"],[\"JDCC\",29,\"jdcc\"],[\"RTF\",27,\"rtf\"],[\"JAG\",24,\"jag\"],[\"HIMARS\",24,\"himars\"],[\"TG AREs\",23,\"tg-ares\"],[\"EOC\",20,\"eoc\"],[\"BPT\",20,\"bpt\"],[\"Squirter\",19,\"squirter\"],[\"PoA\",19,\"poa\"],[\"B-HUTS\",16,\"b-huts\"],[\"N/I C\",15,\"ni-c\"],[\"OCCD\",14,\"occd\"],[\"CTC\",14,\"ctc\"],[\"HVI\",13,\"hvi\"],[\"PRO COY\",13,\"pro-coy\"],[\"C//NF\",12,\"cnf\"],[\"MTT\",12,\"mtt\"],[\"TF373\",12,\"tf373\"],[\"JUGROOM\",12,\"jugroom\"],[\"BSSM\",11,\"bssm\"],[\"Blue on Blue\",10,\"blue-on-blue\"],[\"CGBG\",9,\"cgbg\"],[\"SWO\",8,\"swo\"],[\"UH-1N\",8,\"uh-1n\"],[\"OPSUM\",7,\"opsum\"],[\"JEL\",7,\"jel\"],[\"buzz saw\",6,\"buzz-saw\"],[\"RB\",6,\"rb\"],[\"cgbg 1 coy\",5,\"cgbg-1-coy\"],[\"OP grid\",5,\"op-grid\"],[\"SFG\",5,\"sfg\"],[\"ENG BDE\",4,\"eng-bde\"],[\"HMLA-169\",4,\"hmla-169\"],[\"BTG\",3,\"btg\"],[\"SOTG\",3,\"sotg\"],[\"AIHRC\",3,\"aihrc\"],[\"Blue forces\",2,\"blue-forces\"],[\"SCIDA\",2,\"scida\"],[\"SEWOC\",2,\"sewoc\"],[\"Thready\",1,\"thready\"],[\"IAW EOF SOP\",1,\"iaw-eof-sop\"],[\"MEY PRT\",1,\"mey-prt\"],[\"PSO\",1,\"pso\"],[\"MED TM\",1,\"med-tm\"],[\"SC-26\",1,\"sc-26\"],[\"PLT SJT\",1,\"plt-sjt\"],[\"Beaten zone\",1,\"beaten-zone\"]]"
end
